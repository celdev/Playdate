<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map</title>
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/CoordinateHandler.js"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
<script>
    Object.prototype.hasOwnProperty = function(property) {
        return this[property] !== undefined;
    };

    var loadPlaces = function () {
        console.log();
        var lat = window.map.getCenter().lat();
        var lng = window.map.getCenter().lng();;
        console.log("Lat = " + lat);
        console.log("Lng = " + lng);

        $.getJSON('/getplacebylocation?locX=' + lat + '&locY='+lng, {}, function(data) {
            console.log(data)
            $.each(data,function(index, place) {
                var strOut = "<h3>" + place.name + "</h3>";
                strOut += "<img src='/protected/apiimage/" + place.imageId + "'>";
                strOut += "<div>";
                var desc = "Beskrivning saknas";
                if (place.hasOwnProperty('shortDescription')) {
                    if (place.hasOwnProperty('longDescription')) {
                        desc = place.longDescription;
                    } else {
                        desc = place.shortDescription;
                    }
                }
                strOut += "<p>" + desc + "</p>";
                strOut += "<a href='/protected/getoneplace?placeId=" + place.id + "'>GÃ¥ till plats</a>";
                strOut += "</div>";
                $('#output').append(strOut);

                var ch = new CoordinateHandler();
                var latLng = ch.gridToGeodetic(place.geoX, place.geoY);
                console.log(latLng);
                var lat = latLng.lat;
                var lng = latLng.lon;

                var pos = {lat: lat, lng: lng};

                var marker = new google.maps.Marker({
                    position: pos,
                    map: map
                });


        })
    })
    };
</script>
<h1>Hello world</h1>
<div id="map"> </div>
<script>
    function initMap() {
        var uluru = {lat: 59.299258865101194, lng: 18.044908470153807};
        window.map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: uluru
        });
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=API_NYCKEL&callback=initMap">
</script>
<input type="button" value="Load places" onclick="loadPlaces()">
<div id="output">

</div>
</body>
</html>