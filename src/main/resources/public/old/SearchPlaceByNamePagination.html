<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="js/CoordinateHandler.js"></script>
</head>
<body>
<input type="text" id="textfield" value="sök på namn">
<input type="button" id="skicka" value="sök">
<script>
    Object.prototype.hasOwnProperty = function(property) {
        return this[property] !== undefined;
    };

    var pendingAjax = false;
    var offset = 0;

    function sendSearch() {
        pendingAjax = true;
        $.getJSON('/getplacebyname?name=' + $('#textfield').val() + '&offset=' + offset, {}, function (data) {
            console.log(data);
            offset = parseInt(data.value.paginationOffset) + 10 ;
            $.each(data.value.collection, function (index, place) {
                pendingAjax = false;
                renderPlace(place);
            })
        });
    }
    $('#skicka').click(function () {
        sendSearch();
    });


    $(window).scroll(function () {
        console.log("pending ajax is " + pendingAjax);
        var atHeight = ($(window).scrollTop() + $(window).height());
        var totalHeight = $(document).height() -50;

        console.log("at height = " + atHeight);
        console.log("total height = " + totalHeight);
        var bo = (atHeight > totalHeight);
        console.log("if statement is " + bo);
        if (bo && !pendingAjax) {
            console.log("scrolled to buttom");
            sendSearch();
        }
    });

    function renderPlace(place) {
        var strOut = "<h3>" + place.name + "</h3>";
        strOut += "<img src='/protected/apiimage/" + place.imageId + "'>";
        strOut += "<div>";
        var desc = "Beskrivning saknas";
        if (place.hasOwnProperty('shortDescription')) {
            if (place.hasOwnProperty('longDescription')) {
                desc = place.longDescription;
            } else {
                desc = place.shortDescription;
            }
        }
        strOut += "<p>" + desc + "</p>";
        strOut += "<a href='/protected/getoneplace?placeId=" + place.id + "'>Gå till plats</a>";
        strOut += "</div>";
        $('#output').append(strOut);


    }
</script>
<h1>Hello world</h1>
<div id="output">
</div>

</body>
</html>