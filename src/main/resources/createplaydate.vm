#* @vtlvariable name="playdate" type="model.Playdate" *#


<!DOCTYPE html>
<html>
<head>
    <title>Playdate</title>

    #parse("head-links.vm")

    <link rel="stylesheet" type="text/css" href="/css/jtsage-datebox.css">
    <script src="/js/jtsage-datebox.js"></script>


    <script>
        $(document).ready(function() {
            $('#place-search-type').change(function(e) {
                var searchtype = $('#place-search-type').val();
                $('.place-searcher-div').each(function(index, div) {
                    var id = $(this).data('search-type-id');
                    if (id == searchtype) {
                        $(this).removeClass('hidden')
                    } else {
                        if (!$(this).hasClass('hidden')) {

                            $(this).addClass('hidden');
                        }
                    }
                })
            })
        });

    </script>
    <script>

        $(document).ready(function () {

            var searchField = $('#place-input-field');

            var searchSuggestionts = $('#search-suggestions');

            searchField.on('input',function(e) {
                var text = $(this).val();
                if(text.length > 3) {
                    $.getJSON('/protected/searchplacebyterm?searchTerm=' + text, {}, function(data) {
                        var suggestion = "";
                        console.log(data)
                        $.each(data,function(index,place){
                            suggestion += "<li class='place-list-object' data-place-name="+ place.name + " data-place-id="+ place.id + ">" + place.name+ "</li>"
                        });
                        searchSuggestionts.html(suggestion);
                        searchSuggestionts.listview("refresh");

                    })
                }
            })

            searchSuggestionts.on('click',".place-list-object",function(e) {
                var placeId = $(this).data('placeId');
                var placeName = $(this).data('placeName');
                $('#show-place-placeholder').html(
                        "<p class='name-with-button'>" + placeName + "</p>" +
                        "<a href='/protected/showplace?placeId=" + placeId +"'>Visa</a>"
                );
                $('#placeId').val(placeId);
                searchSuggestionts.html('');
                searchSuggestionts.listview("refresh");
                searchField.val("");
            });

            $('#create-playdate-form').on('submit',function(e) {
                var starttime = $('#startTime');
                var date = $('#datepicker-field').datebox('getTheDate');
                var time = $('#timepicker-field').datebox('getTheDate');
                date.setHours(time.getHours());
                date.setMinutes(time.getMinutes());
                console.log("setting start time to " + date.getTime());
                starttime.val(date.getTime());
                console.log("starttimevalue = " + starttime.val());
            });


            #if($playdate)

                console.log("edit playdatemode");
                $('#create-playdate-form').attr('action', '/protected/updateplaydate');
                $('#playdateId').val("${playdate.id}");
                $('#header-field').val("${playdate.header}");
                $('#description-field').val("${playdate.description}");
                $('#visibility-type').val("${playdate.playdateVisibilityType.nr}").change();
                $('#placeid').val("${playdate.getPlace().id}");
                $('#show-place-placeholder').html(
                        "<p class='name-with-button'>" + "${playdate.getPlace().name}" +"</p>" +
                        "<a href='/protected/showplace?placeId=" + "${playdate.id}" +"'>Visa</a>"
                );
                var startTimeDate = new Date(${playdate.startTime})
                var year = startTimeDate.getFullYear();
                var month = startTimeDate.getMonth();
                var day = startTimeDate.getDate();
                var time = "" + startTimeDate.getHours() + ":" + startTimeDate.getMinutes();
                var dateBoxDate = new Date(year, month, day);
                $('#datepicker-field').datebox('setTheDate', dateBoxDate);
                $('#timepicker-field').datebox('setTheDate', time);
            #end

        });

    </script>


</head>
<body>


    #parse("side-panel.vm")

    #parse("header.vm")

    #parse("footer.vm")




<div data-role="page" id="pageone">




    <div data-role="main" class="ui-content">
        <form id="create-playdate-form" method="POST" action="/protected/createplaydate" data-ajax="false">
            <input type="hidden" value="-1" name="playdateId" id="playdateId">
            <label for="header-field">
                Rubrik:
            </label>
            <input type="text" name="header" id="header-field">
            <div data-role="ui-field-contain">
                <label for="description-field">
                    Beskrivning:
                </label>
                <textarea name="description" id="description-field" cols="40" rows="8"></textarea>
            </div>
            <div data-role="popup" id="popupBasic">
                <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>

                <div data-role="main" class="ui-content">
                    <table class="place-info-table">
                        <tr>
                            <td>Privat:</td>
                            <td>Bjud in dina vänner att delta i Playdaten</td>
                        </tr>
                        <tr>
                            <td>Öppen för vänner:</td>
                            <td>Playdaten blir synlig för alla dina vänner</td>
                        </tr>
                        <td>Offentlig:</td>
                        <td>Playdaten blir synlig för alla användare</td>
                        </tr>
                    </table>
                </div>
            </div>


            <div class="ui-field-contain">
                <div class="visibility-btn">
                    <label for="visibility-type">Öppenhetsnivå:
                        <a href="#popupBasic" data-rel="popup" style="margin-left: 34%;margin-top: -7%;" id="info-btn" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-inline ui-icon-info ui-btn-icon-notext" data-transition="pop">info</a>
                    </label>
                </div>
                    <select name="visibilityId" id="visibility-type">
                    <option value="0">Privat</option>
                    <option value="1">Öppen för vänner</option>
                    <option value="2">Offentlig</option>
                </select>
            </div>
            <label>Datum och tid</label>
            <input type="hidden" name="startTime" id="startTime" value="0">
            <div class="date-row">
                <div class="date-column">
                    <input type="text" id="datepicker-field" data-role="datebox" data-options='{"mode":"flipbox", "afterToday": true}'>
                </div>
                <div class="date-column">
                    <input type="text" id="timepicker-field" data-role="datebox" data-options='{"mode":"timebox"}'>
                </div>
            </div>
            <div>

                <label for="place-input-field">Sök plats:</label>
                <input type="search" name="place-input-field" id="place-input-field">
                <ul id="search-suggestions" data-role="listview" data-inset="true" data-filter="true" data-filter-reveal="true" data-input="#place-input-field">
                    <li>Test</li>
                </ul>
                <a href="#choose-place" class="ui-btn ui-icon-arrow-r ui-btn-icon-right">Hitta platser nära mig</a>
            </div>
            <input type="hidden" name="placeId" id="placeId" value="-1">
            <hr>
            <div id="show-place-placeholder">
                <h2>Ingen plats vald</h2>
            </div>
            <hr>
            <div>
                <input type="submit" class="ui-btn last-button-on-page" data-ajax="false" id="create-playdate-btn" value="Skapa Playdate">
            </div>
        </form>
    </div>


</div>

<div data-role="page" id="choose-place">

    <div data-role="main" class="ui-content">
        <h2>Sök Plats</h2>
        <div>

            <div class="ui-field-contain">
                <label for="place-search-type">Sökmetod</label>
                <select name="place-search-type" id="place-search-type">
                    <option value="0">Sök nära mig</option>
                    <option value="1">Sök på karta</option>
                    <option value="2">Sök på namn</option>
                    <option value="3">Sök på område</option>
                </select>
            </div>
        </div>
        <div id="place-searcher">
            <div id="place-searchby-close" class="place-searcher-div" data-search-type-id="0">
                <a href="#" class="ui-btn">Hämta min plats</a>
                <p id="place-by-loc-error"></p>
            </div>
            <div class="hidden place-searcher-div" id="place-searchby-map" data-search-type-id="1">
                <a href="#" class="ui-btn">Öppna Karta</a>
                <p id="place-by-map-error"></p>
            </div>
            <div class="hidden place-searcher-div" id="place-searchby-name" data-search-type-id="2">
                <form>
                    <label for="place-by-name-field">Sök på namn:</label>
                    <input type="text" name="place-by-name-field" id="place-by-name-field">
                    <a href="#" class="ui-btn" id="submit-search-by-name">Sök</a>
                </form>
            </div>
            <div class="hidden place-searcher-div" id="place-searchby-area" data-search-type-id="3">
                <form>
                    <label for="place-by-name-field">Sök på områdesnamn:</label>
                    <div class="ui-field-contain">
                        <label for="area-name-select">Område:</label>
                        <select name="area-name-select" id="area-name-select">
                            <option value="0">Norrmalm</option>
                            <option value="1">Test2</option>
                            <option value="2">Test3</option>
                        </select>
                    </div>
                    <a href="#" class="ui-btn" id="submit-search-by-area-name">Sök</a>
                </form>
            </div>
            <div id="place-results"></div>
        </div>
    </div>

</div>

</body>
</html>