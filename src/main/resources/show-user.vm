#* @vtlvariable name="playdates" type="java.util.Collection" *#
#* @vtlvariable name="p" type="model.Playdate" *#
#* @vtlvariable name="other-user" type="model.User" *#

<!DOCTYPE html>
<html>
<head>
    <title>Playdate</title>

    #parse("head-links.vm")


    <script>

        $(document).ready(function () {

            $('#add-friend').click(function (e) {
                e.preventDefault();

                $.post('/protected/sendfriendrequest?friendId=' + $(this).data('userid'), function(res) {
                    console.log(res);
                })

            })



            $('#remove-friend').click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'DELETE',
                    url: '/protected/removefriend?userId=' + $(this).data('userid'),
                    success: function(res) {
                        console.log("res = " + res);
                    }
                });
            });

            $('#remove-friendrequest').click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'DELETE',
                    url: '/protected/removefriendshiprequest?userId=' + $(this).data('userid'),
                    success: function(res) {
                        console.log("res = " + res);
                    }
                });
            });
            $('#accept-friendrequest').click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '/protected/acceptfriendshiprequest?userId=' + $(this).data('userid'),
                    success: function(res) {
                        console.log("res = " + res);
                    }
                });
            });
            $('#decline-friendrequest').click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '/protected/declinefriendshiprequest?userId=' + $(this).data('userid'),
                    success: function(res) {
                        console.log("res = " + res);
                    }
                });
            });



            $('#send-report').click(function(e) {
                e.preventDefault();
                e.stopImmediatePropagation();

                $.ajax({
                    type: 'POST',
                    url: '/protected/postreport',
                    data: $('#makeReport').serialize(),
                    success: function (res) {
                        console.log(res);
                        $('#report').val("");
                       $('#popupReport').popup('close');



                    }

                });





            })
        })

    </script>


</head>
<body>


    #parse("side-panel.vm")

    #parse("header.vm")

    #parse("footer.vm")

<div data-role="page" id="pageone">


    <div data-role="main" class="ui-content">
        <div data-role="popup" id="popupReport">
            <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
            <div data-role="header">
                <h1>Rapportera</h1>
            </div>
            <div data-role="main" class="ui-content" id="make-report">
                <form data-ajax="false" id="makeReport" action="/protected/postreport" method="POST">
                    <textarea cols="30" rows="8" name="reportDescription" id="report" placeholder="Skriv anmälan"></textarea>
                    <input type="hidden" name="userId" value="$!other-user.id">
                    <input data-ajax="false" id="send-report" type="submit" class="ui-btn" value="Skicka">
                </form>
            </div>

        </div>
        <div class="other-user-reportable">

            <h2>$!{other-user.name}</h2>

        </div>

        <div class="ui-grid-a profile-page">
            <div class="ui-block-a">
                <div id="composite-picture">
                    <img src="$!{other-user.profilePictureUrl}" class="profile-picture" style="width: 9em">
                </div>
                <a href="$!{other-user.facebookLinkUrl}">Visa Facebookprofil</a>
                <h3>Beskrivning:</h3>
                <p class="profile-description-text">
                    $!{other-user.description}
                </p>
                <p>Telefonnummer: $!{other-user.phoneNumber}</p>
                <p>Kön: $!{other-user.gender.frontname}</p>
            </div>
            <div class="ui-block-b profile-right-block" style="margin-top: 20%;">

                #if($friendsetting == 0)

                    <p><a data-ajax="false" href="/protected/editmyprofile">Redigera</a></p>
                #elseif($friendsetting == 1)
                    <a data-ajax="false" data-userid="$!other-user.id" id="remove-friend">Ta bort vän</a>
                #elseif($friendsetting == 2)
                    <a href="#" data-ajax="false" data-userid="$other-user.id" id="accept-friendrequest">Acceptera vän</a>
                    <a href="#" data-ajax="false" data-userid="$other-user.id" id="decline-friendrequest">Avböj vänförfrågan</a>
                #elseif($friendsetting == 3)
                    <a href="#" data-userid="$!other-user.id" id="remove-friendrequest" class="ui-btn ui-corner-all ui-shadow" style="font-size: 8px;" data-ajax="false">Ta bort vänskapsförfrågan</a>
                #elseif($friendsetting == 4)
                    <a href="#" id="add-friend" data-userid="$other-user.id" class="ui-btn ui-corner-all ui-shadow data-mini="true">Lägg till vän</a>
                #end


                <div data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-iconpos="right">

                    <h4>Playdates</h4>


                    #foreach($p in $playdates)
                        <a href="/protected/getoneplaydate?playdateId=$!{p.id}">$p.header</a></br>

                    #end
                </div>

            </div>
            <a href="#popupReport" id="rapportera-användare" data-rel="popup" data-transition="slideup">Rapportera användare</a>
        </div>
    </div>


</div>

</body>
</html>